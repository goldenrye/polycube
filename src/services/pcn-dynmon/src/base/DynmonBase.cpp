/**
* dynmon API generated from dynmon.yang
*
* NOTE: This file is auto generated by polycube-codegen
* https://github.com/polycube-network/polycube-codegen
*/


/* Do not edit this file manually */


#include "DynmonBase.h"

DynmonBase::DynmonBase(const std::string name) {
  logger()->set_pattern("[%Y-%m-%d %H:%M:%S.%e] [Dynmon] [%n] [%l] %v");
}

DynmonBase::~DynmonBase() {}

void DynmonBase::update(const DynmonJsonObject &conf) {
  set_conf(conf.getBase());

  if (conf.dataplaneIsSet()) {
    auto m = getDataplane();
    m->update(conf.getDataplane());
  }
  if (conf.metricsIsSet()) {
    for (auto &i : conf.getMetrics()) {
      auto name = i.getName();
      auto m = getMetrics(name);
      m->update(i);
    }
  }
}

/**
* This method has been modified in order to not duplicate the metrics in both json and OpenMetrics format.
* The OpenMetrics format metrics are not included in the response json.
**/
DynmonJsonObject DynmonBase::toJsonObject() {
  DynmonJsonObject conf;
  conf.setBase(to_json());

  conf.setName(getName());
  conf.setDataplane(getDataplane()->toJsonObject());
  for(auto &i : getMetricsList()) {
    conf.addMetrics(i->toJsonObject());
  }
  //conf.setOpenMetrics(getOpenMetrics());

  return conf;
}

void DynmonBase::replaceDataplane(const DataplaneJsonObject &conf) {
  delDataplane();
  addDataplane(conf);
}

void DynmonBase::addMetricsList(const std::vector<MetricsJsonObject> &conf) {
  for (auto &i : conf) {
    std::string name_ = i.getName();
    addMetrics(name_, i);
  }
}

void DynmonBase::replaceMetrics(const std::string &name, const MetricsJsonObject &conf) {
  delMetrics(name);
  std::string name_ = conf.getName();
  addMetrics(name_, conf);
}

void DynmonBase::delMetricsList() {
  auto elements = getMetricsList();
  for (auto &i : elements) {
    std::string name_ = i->getName();
    delMetrics(name_);
  }
}
